{#-
  1. HERENCIA DIRECTA:
  Heredamos directamente de tu plantilla de dashboard principal.
  Esto asegura que siempre tendremos la barra lateral y el encabezado correctos.
-#}
{% extends 'layouts/dashboard.html' %}

{#-
  2. BLOQUE DE CONTENIDO CORRECTO:
  Inyectamos todo el contenido de esta página en el bloque 'dashboard_content',
  que es el que tu plantilla 'dashboard.html' espera.
-#}
{% block dashboard_content %}
<div class="container-fluid px-4">
    
    <h1 class="mt-4 mb-4">Registro de Errores del Sistema</h1>

    <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Historial de Errores Recientes</h5>
            {# Este botón llama a la ruta de prueba que creamos en sistemas_routes.py #}
            <a href="{{ url_for('sistemas.generar_error_prueba') }}" class="btn btn-outline-warning btn-sm">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>Generar Error de Prueba
            </a>
        </div>
        <div class="card-body">
            <p class="card-text text-muted mb-4">
                A continuación se muestran los últimos errores registrados por la aplicación.
            </p>

            <div class="table-responsive">
                <table class="table table-bordered table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th scope="col">Fecha y Hora</th>
                            <th scope="col">Módulo / Ruta</th>
                            <th scope="col">Mensaje de Error</th>
                            <th scope="col">Usuario</th>
                        </tr>
                    </thead>
                    <tbody>
                        {# --- Bucle de Jinja que muestra los errores REALES que vienen desde Python --- #}
                        {% for error in errores %}
                        <tr>
                            {# Formateamos la fecha para que se vea amigable #}
                            <td>{{ error.fecha_hora.strftime('%d/%m/%Y %H:%M:%S') }}</td>
                            <td>{{ error.modulo }}</td>
                            <td><small>{{ error.descripcion }}</small></td>
                            {# Si no hay un usuario asociado (ej. error del sistema), muestra 'Sistema' #}
                            <td>{{ error.usuario or 'Sistema' }}</td>
                        </tr>
                        {% else %}
                        {# Este bloque se muestra si la lista 'errores' está vacía #}
                        <tr>
                            <td colspan="4" class="text-center text-muted fst-italic py-4">
                                ¡Felicidades! No hay registros de errores disponibles.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}